<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIÂ§öÂäüËÉΩÁè≠Á∫ßÊïôÂ≠¶Á≥ªÁªü - V3</title>
    
    <!-- Â≠ó‰Ωì‰∏éÂõæÊ†áÂ∫ì -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Ma+Shan+Zheng&family=Zcool+KuaiLe&family=Orbitron:wght@500;900&family=Russo+One&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Ê†∏ÂøÉÂäüËÉΩÂ∫ìÔºàÂ∑≤Êîπ‰∏∫ npm + importÔºåÁî± src/main.js Áªü‰∏ÄÂºïÂÖ•Ôºâ -->

  <script type="module" crossorigin src="/assets/index-BogN4TwW.js"></script>
  <link rel="stylesheet" crossorigin href="/assets/index-C-STBMZt.css">
  <style>
    .header-hud {
      position: relative;
      gap: 12px;
    }
    .header-hud > div:first-child {
      flex: 0 0 auto;
      white-space: nowrap;
    }
    .header-center-title {
      position: static !important;
      left: auto !important;
      transform: none !important;
      flex: 1 1 auto;
      min-width: 0;
      display: flex !important;
      align-items: center;
      justify-content: center;
      z-index: 1;
      text-align: center;
    }
    .wild-header-wrapper {
      max-width: 100%;
    }
    .wild-header-title {
      max-width: 100%;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .header-hud > div:last-child {
      flex: 0 0 auto;
    }

    .wb-pages-sidebar {
      background: linear-gradient(180deg, #ffffff 0%, #eff6ff 100%) !important;
      border-right: 1px solid #bfdbfe !important;
    }
    .wb-page-action {
      background: #ffffff !important;
      border: 1px solid #cbd5e1 !important;
      color: #0f172a !important;
      box-shadow: 0 12px 30px -24px rgba(15, 23, 42, 0.35);
    }
    .wb-page-action:hover {
      background: #eff6ff !important;
    }
    .wb-page-thumb {
      background: #f8fafc !important;
      border: 1px solid #cbd5e1 !important;
      color: #334155 !important;
    }
    .wb-page-thumb img {
      background: #e2e8f0 !important;
    }
    .wb-page-thumb .wb-page-label {
      color: #0f172a !important;
    }

    .panel-tabs {
      background: linear-gradient(180deg, #ffffff 0%, #eff6ff 100%) !important;
      border-bottom: 1px solid #bfdbfe !important;
      box-shadow: 0 18px 50px -40px rgba(59, 130, 246, 0.55);
    }
    .p-tab {
      color: #475569 !important;
    }
    .p-tab:hover {
      color: #0f172a !important;
      background: rgba(59, 130, 246, 0.10) !important;
    }
    .p-tab.active {
      color: #2563eb !important;
      background: rgba(59, 130, 246, 0.12) !important;
      border-bottom-color: #2563eb !important;
    }

    .controls {
      background: rgba(255, 255, 255, 0.78) !important;
      border: 1px solid rgba(191, 219, 254, 0.95) !important;
      box-shadow: 0 22px 70px -45px rgba(59, 130, 246, 0.6) !important;
      backdrop-filter: blur(10px);
      transform: translateX(-50%) scale(1) !important;
      transition: transform 0.18s ease, box-shadow 0.18s ease, background-color 0.18s ease, border-color 0.18s ease;
    }
    .controls.minimized {
      background: rgba(255, 255, 255, 0.78) !important;
    }
    .controls:not(.minimized):hover {
      box-shadow: 0 0 0 4px rgba(251, 191, 36, 0.10), 0 28px 85px -55px rgba(251, 191, 36, 0.85) !important;
      transform: translateX(-50%) scale(1.03) !important;
    }
    .ctrl-btn {
      background: #ffffff !important;
      border: 1px solid #cbd5e1 !important;
      color: #0f172a !important;
      transition: transform 0.18s ease, box-shadow 0.18s ease, background-color 0.18s ease, border-color 0.18s ease;
    }
    .ctrl-btn:hover {
      background: #eff6ff !important;
      color: #0f172a !important;
      border-color: rgba(147, 197, 253, 0.95) !important;
      box-shadow: 0 0 0 4px rgba(251, 191, 36, 0.18), 0 18px 60px -35px rgba(251, 191, 36, 0.75);
      transform: translateY(-1px) scale(1.06);
    }
    .ctrl-btn:active {
      transform: scale(0.98);
      box-shadow: 0 0 0 3px rgba(251, 191, 36, 0.14), 0 10px 40px -28px rgba(251, 191, 36, 0.65);
    }
    .ctrl-btn:focus-visible {
      outline: none;
      box-shadow: 0 0 0 4px rgba(251, 191, 36, 0.22), 0 18px 60px -35px rgba(251, 191, 36, 0.75);
    }

    .p-tab {
      transition: background-color 0.18s ease, color 0.18s ease, box-shadow 0.18s ease;
    }
    .p-tab:hover {
      box-shadow: inset 0 -2px 0 rgba(245, 158, 11, 0.65), 0 16px 45px -38px rgba(251, 191, 36, 0.75);
    }

    .wb-page-action {
      transition: transform 0.18s ease, box-shadow 0.18s ease, background-color 0.18s ease, border-color 0.18s ease;
    }
    .wb-page-action:hover {
      border-color: rgba(147, 197, 253, 0.95) !important;
      box-shadow: 0 0 0 4px rgba(251, 191, 36, 0.18), 0 18px 60px -35px rgba(251, 191, 36, 0.65);
      transform: translateY(-1px);
    }

    .wb-page-thumb {
      transition: transform 0.18s ease, box-shadow 0.18s ease, border-color 0.18s ease, background-color 0.18s ease;
    }
    .wb-page-thumb:hover {
      border-color: rgba(147, 197, 253, 0.95) !important;
      box-shadow: 0 0 0 4px rgba(251, 191, 36, 0.14), 0 22px 70px -45px rgba(251, 191, 36, 0.65);
      transform: translateY(-1px);
    }

    #practice-layer {
      background: linear-gradient(180deg, #ffffff 0%, #eff6ff 100%) !important;
    }
    #practice-layer > div:first-child {
      background: linear-gradient(180deg, #ffffff 0%, #eff6ff 100%) !important;
      border-bottom: 1px solid #bfdbfe !important;
    }
    #practice-layer .reupload-btn {
      background: #ffffff !important;
      color: #0f172a !important;
      border: 1px solid #cbd5e1 !important;
      box-shadow: 0 18px 55px -45px rgba(59, 130, 246, 0.55);
      transition: transform 0.18s ease, box-shadow 0.18s ease, border-color 0.18s ease;
    }
    #practice-layer .reupload-btn:hover {
      border-color: rgba(245, 158, 11, 0.75) !important;
      box-shadow: 0 0 0 4px rgba(251, 191, 36, 0.18), 0 18px 60px -35px rgba(251, 191, 36, 0.75);
      transform: translateY(-1px) scale(1.02);
    }
    #practice-layer #viewer-practice {
      background: transparent !important;
    }
    #practice-layer .resource-viewer,
    #practice-layer .resource-viewer.dark-mode {
      background: transparent !important;
      color: #0f172a !important;
    }

  </style>
</head>
<body>

    <div id="app-container">
        <!-- Â∑¶‰æß (ÊïôÂ≠¶ÁôΩÊùø - Êõ¥Êñ∞Áâà) -->
        <div id="lecture-panel">
            <div class="panel-tabs">
                <div class="p-tab active" onclick="app.switchTab('teaching')"><i class="fas fa-chalkboard-teacher"></i> ÊïôÂ≠¶ÊºîÁ§∫ (Êí≠Êîæ)</div>
                <div class="p-tab" onclick="app.switchTab('practice')"><i class="fas fa-edit"></i> Ëá™Áî±ÁªÉ‰π† (‰∏áËÉΩ)</div>
                <div class="p-tab" onclick="app.toggleFullScreen('lecture-panel')" style="flex:0; padding:12px 20px; color:var(--primary);" title="ÂÖ®Â±è/ÈÄÄÂá∫">
                    <i class="fas fa-expand"></i>
                </div>
            </div>

            <div class="whiteboard-wrapper" id="wb-wrapper">
                <div class="wb-pages-sidebar" id="wb-pages-sidebar">
                    <div class="wb-pages-actions">
                        <button class="wb-page-action" id="wb-pages-toggle-btn" onclick="wb.togglePagesSidebar()" title="Êî∂Áº©/Â±ïÂºÄ"><i class="fas fa-chevron-left"></i></button>
                        <button class="wb-page-action" id="wb-page-add-btn" onclick="wb.addPage()" title="Êñ∞Â¢ûÈ°µÈù¢"><i class="fas fa-plus"></i></button>
                        <button class="wb-page-action" id="wb-page-del-btn" onclick="wb.deletePage()" title="Âà†Èô§ÂΩìÂâçÈ°µÈù¢"><i class="fas fa-trash"></i></button>
                    </div>
                    <div class="wb-pages-list" id="wb-pages-list"></div>
                </div>

                <div class="wb-stage" id="wb-stage">
                    <div id="zoom-area" class="zoom-container">
                    
                    <div id="course-player-layer" style="position:absolute; top:0; left:0; width:100%; height:100%; z-index:10; background:#ffffff; display:flex; flex-direction:column;">
                        
                        <div style="height:50px; background:#f8fafc; display:flex; align-items:center; padding:0 20px; justify-content:space-between; border-bottom:2px solid #e2e8f0;">
                            <div style="font-size:1rem; color:#0f172a; font-weight:bold; display:flex; align-items:center; gap:10px;">
                                <i class="fas fa-folder-open" style="color:var(--primary);"></i> 
                                <span id="cp-lesson-title">Á≠âÂæÖËØªÂèñËØæ‰ª∂...</span>
                            </div>
                            <div style="font-size:0.9rem; background:#0f172a; color:#fff; padding:4px 12px; border-radius:20px; font-weight:bold; transform: skew(-10deg);">
                                STEP <span id="cp-step-index" style="color:#fbbf24;">0</span> / <span id="cp-total-steps">0</span>
                            </div>
                        </div>

                        <div id="cp-content-area" style="flex:1; position:relative; overflow:auto; display:flex; justify-content:center; align-items:center; background:#ffffff;">
                            <div style="color:#94a3b8; text-align:center;">
                                <div style="width:100px; height:100px; background:#f1f5f9; border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 20px auto;">
                                    <i class="fas fa-cloud-upload-alt" style="font-size:3rem; color:#cbd5e1;"></i>
                                </div>
                                <div style="font-size:1.5rem; font-weight:bold; color:#cbd5e1;">ÂáÜÂ§áÂ∞±Áª™</div>
                                <div style="margin-top:5px;">ËØ∑ÁÇπÂáªÂ∫ïÈÉ®ÈªÑËâ≤ÊåâÈíÆËØªÂèñËØæ‰ª∂</div>
                            </div>
                        </div>

                        <div style="height:90px; background:linear-gradient(to top, #ffffff, rgba(255,255,255,0)); display:flex; align-items:center; justify-content:center; gap:40px; padding-bottom:10px;">
                            
                            <button onclick="app.prevStep()" class="wild-nav-btn wild-btn-prev">
                                <i class="fas fa-arrow-left"></i> PREV
                            </button>
                            
                            <button onclick="app.nextStep()" class="wild-nav-btn wild-btn-next">
                                NEXT <i class="fas fa-arrow-right"></i>
                            </button>
                            
                        </div>
                    </div>                    <div id="practice-layer" style="position:absolute; top:0; left:0; width:100%; height:100%; z-index:11; background:#000; display:none; flex-direction:column;">
                        <div style="padding:10px; background:#222; text-align:center; border-bottom:1px solid #333;">
                            <button class="reupload-btn" style="position:static; display:inline-flex;" onclick="el('genericFileLoader').click()">
                                <i class="fas fa-cloud-upload-alt"></i> ÊâìÂºÄ‰ªªÊÑèÁªÉ‰π†Êñá‰ª∂ (PDF/Word/ËßÜÈ¢ë/Âõæ)
                            </button>
                        </div>
                        <div id="viewer-practice" class="resource-viewer" style="flex:1; display:flex;"></div>
                    </div>

                    <div id="grid-layer">
                        <div class="axis-container">
                            <div class="axis-x"></div>
                            <div class="axis-y"></div>
                            <div class="origin-label">O</div>
                        </div>
                    </div>

                    <canvas id="drawing-canvas" class="drawing-canvas" style="z-index:50;"></canvas>

                </div>

                <div id="ai-assistant-card" class="ai-floater" style="display:none;">
                    <div class="ai-avatar-box">
                        <div id="ai-icon-visual" class="ai-icon">ü§ñ</div>
                        <div class="ai-wave"></div>
                    </div>
                    <div class="ai-chat-bubble">
                        <div id="ai-status-label" style="font-size:0.8rem; color:#aaa; margin-bottom:4px;">Á≠âÂæÖÊåá‰ª§...</div>
                        <div id="ai-text-content" style="font-size:1rem; font-weight:bold; color:white; line-height:1.4;">
                            ‰Ω†Â•ΩÔºåÊàëÊòØ‰Ω†ÁöÑ AI Âä©Êïô„ÄÇ
                        </div>
                    </div>
                </div>

                <div class="wb-toolbar" id="wb-toolbar">
                    <button class="wb-btn toggle-btn" onclick="app.toggleBar('wb-toolbar', this)"><i class="fas fa-chevron-left"></i></button>
                    <div class="color-palette">
                        <div class="color-dot active" style="background:red" onclick="wb.setColor('red', this)"></div>
                        <div class="color-dot" style="background:yellow" onclick="wb.setColor('yellow', this)"></div>
                        <div class="color-dot" style="background:white" onclick="wb.setColor('white', this)"></div>
                    </div>
                    <button class="wb-btn" id="btn-cursor" onclick="wb.setMode('cursor')" title="Èº†Ê†áÊìç‰Ωú(ÁÇπËßÜÈ¢ë/ÁøªÈ°µ)"><i class="fas fa-mouse-pointer"></i></button>
                    <button class="wb-btn" id="btn-pen" onclick="wb.setMode('pen')" title="ÁîªÁ¨î‰π¶ÂÜô"><i class="fas fa-pen"></i></button>
                    <button class="wb-btn" onclick="wb.setMode('eraser')"><i class="fas fa-eraser"></i></button>
                    
                    <button class="wb-btn" id="mic-btn" onclick="app.toggleVoice()" title="ÁÇπÂáªÂºÄÂêØ/ÂÖ≥Èó≠ËØ≠Èü≥ÂØπËØù" style="border:1px solid #d946ef; color:#d946ef;">
                        <i class="fas fa-microphone-slash"></i>
                    </button>                    <button class="wb-btn" onclick="app.manualInput()" title="ÊâìÂ≠óËæìÂÖ•Êåá‰ª§" style="color:white; border:1px solid #aaa;">
                        <i class="fas fa-keyboard"></i>
                    </button>

                    <button class="wb-btn" onclick="app.askDeepSeek('Â∏ÆÊàëÂá∫‰∏ÄÈÅìÂãæËÇ°ÂÆöÁêÜÁöÑËÆ°ÁÆóÈ¢ò')" style="border:1px solid lime; color:lime;">Êµã</button>                    <button class="wb-btn" onclick="wb.clear()"><i class="fas fa-trash"></i></button>
                </div>                <!-- Âè≥‰æßÁÅµÂä®Â≠¶ÁßëÂùû (Â∑≤Êõ¥Êñ∞ÔºöËÉ∂ÂõäÈ£éÊ†º) -->
                <div id="subject-dock" class="subject-dock">
                    
                    <!-- 1. Êï∞Â≠¶ÂõæÊ†á -->
                    <div class="dock-item math" onclick="tools.toggleSubject('math')">
                        <i class="fas fa-square-root-alt"></i>
                        <span>Êï∞Â≠¶</span>
                    </div>

                    <!-- Êï∞Â≠¶Â∑•ÂÖ∑Èù¢Êùø -->
                    <div id="dock-panel-math" class="dock-tools-container">
                        <div>
                            <div class="dock-group-title">Á•ûÁ¨îÈ©¨ËâØ</div>
                            <div class="dock-grid">
                                <button class="dock-tool-btn" onclick="wb.setShapeMode('magic-line')">
                                    <i class="fas fa-slash"></i> Áõ¥Á∫ø
                                </button>
                                <button class="dock-tool-btn" onclick="wb.setShapeMode('magic-circle')">
                                    <i class="far fa-circle"></i> ÂúÜÂΩ¢
                                </button>
                            </div>
                        </div>                        <div>
                            <div class="dock-group-title">Âá†‰ΩïÂõæÂΩ¢</div>
                            <div class="dock-grid">
                                <button class="dock-tool-btn" onclick="wb.setShapeMode('rect')">
                                    <i class="far fa-square"></i> Áü©ÂΩ¢
                                </button>
                                <button class="dock-tool-btn" onclick="wb.setShapeMode('triangle')">
                                    <i class="fas fa-caret-up"></i> ‰∏âËßí
                                </button>
                                
                                <!-- ‚úÖ Êñ∞Â¢ûÔºöÂùêÊ†áÁ≥ªÂºÄÂÖ≥ÊåâÈíÆ -->
                                <button class="dock-tool-btn" onclick="wb.toggleGrid()" title="ÂºÄÂêØ/ÂÖ≥Èó≠ ÂùêÊ†áÁ≥ª">
                                    <i class="fas fa-border-all"></i> ÂùêÊ†áÁ≥ª
                                </button>

                                <!-- (ÂéüÊúâÁöÑÁõ¥Ëßí‰∏âËßíÂΩ¢ÊåâÈíÆÂèØ‰ª•ÁßªÂà∞ÂêéÈù¢ÊàñËÄÖ‰øùÁïô) -->
                                <button class="dock-tool-btn" onclick="wb.setShapeMode('right-triangle')">
                                    <i class="fas fa-ruler-triangle"></i> Áõ¥Ëßí
                                </button>
                            </div>
                        </div>
                        <div>
                            <div class="dock-group-title">ÊñáÂ≠ó</div>
                            <button class="dock-tool-btn" style="width:100%" onclick="wb.setShapeMode('formula')">
                                <i class="fas fa-font"></i> Ê†áÂáÜÂç∞Âà∑‰Ωì
                            </button>
                        </div>
                    </div>

                    <!-- 2. ËØ≠ÊñáÂõæÊ†á -->
                    <div class="dock-item chinese" onclick="tools.toggleSubject('chinese')">
                        <i class="fas fa-book-reader"></i>
                        <span>ËØ≠Êñá</span>
                    </div>
                    
                    <!-- ËØ≠ÊñáÂ∑•ÂÖ∑Èù¢Êùø -->
                    <div id="dock-panel-chinese" class="dock-tools-container">
                        <div style="text-align:center; color:#666; padding:20px 0;">
                            <i class="fas fa-hard-hat" style="font-size:2rem; margin-bottom:10px;"></i>
                            <div>Áî∞Â≠óÊ†º/Á¨îÈ°∫<br>ÂºÄÂèë‰∏≠...</div>
                        </div>
                    </div>

                    <!-- 3. Ëã±ËØ≠ÂõæÊ†á -->
                    <div class="dock-item english" onclick="tools.toggleSubject('english')">
                        <i class="fas fa-font"></i>
                        <span>Ëã±ËØ≠</span>
                    </div>

                    <!-- Ëã±ËØ≠Â∑•ÂÖ∑Èù¢Êùø -->
                    <div id="dock-panel-english" class="dock-tools-container">
                        <div style="text-align:center; color:#666; padding:20px 0;">
                            <i class="fas fa-wrench" style="font-size:2rem; margin-bottom:10px;"></i>
                            <div>ÂõõÁ∫ø‰∏âÊ†º<br>ÂºÄÂèë‰∏≠...</div>
                        </div>
                    </div>

                </div>

                <div id="ai-loading-toast" style="display:none; position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); background:rgba(0,0,0,0.8); padding:20px 40px; border-radius:12px; color:white; z-index:100; text-align:center; border:1px solid #d946ef; box-shadow:0 0 30px #d946ef;">
                    <i class="fas fa-robot fa-spin" style="font-size:3rem; margin-bottom:10px; color:#d946ef;">
                    <div id="ai-toast-text" style="font-size:1.2rem;">Ê≠£Âú®ËÅÜÂê¨...</div>
                </i></div>
                </div>
            </div>        </div>

        
        <!-- Âè≥‰æß (Ëä±ÂêçÂÜå - V1) -->
        <div id="roster-panel">
            <div class="header-hud">
                <div style="font-weight:bold; font-size:1.1rem; color:var(--primary)"><i class="fas fa-users"></i> Áè≠Á∫ßÁúãÊùø (Supabase)</div>
                <div class="header-center-title">
                <div class="wild-header-wrapper">
                    <div class="wild-header-title">
                        AI Â§öÂäüËÉΩÊïôÂ≠¶Âπ≥Âè∞
                        <span class="wild-header-tag">V3</span>
                    </div>
                    
                    <div class="wild-header-author">
                        ÊûóÁª¥Â∫∑
                    </div>
                </div>
            </div>
                <div style="display:flex; gap:5px;">
                    <button class="ctrl-btn" onclick="app.openRace()" style="width:35px; height:35px; display:inline-flex; font-size:0.9rem; background:#7c3aed; color:white;" title="ÊàêÁª©ËµõË∑ë"><i class="fas fa-flag-checkered"></i></button>
                    <button class="ctrl-btn" onclick="app.openAnalysis()" style="width:35px; height:35px; display:inline-flex; background: linear-gradient(135deg, #8b5cf6, #d946ef);" title="Êô∫ËÉΩÂàÜÊûê"><i class="fas fa-chart-line"></i></button>
                    <button class="ctrl-btn" onclick="app.togglePool()" style="width:35px; height:35px; display:inline-flex;"><i class="fas fa-user-friends"></i></button>
                    <button class="ctrl-btn" onclick="app.addGroup()" style="width:35px; height:35px; display:inline-flex;"><i class="fas fa-plus"></i></button>
<!-- Êñ∞Â¢ûÔºöÁΩëÁ´ôÊî∂ËóèÊåâÈíÆ -->
<button class="ctrl-btn" onclick="app.openWebsites()" title="Â∏∏Áî®ÁΩëÁ´ôÊî∂Ëóè" style="background:#0ea5e9; color:white; margin-left:5px;">
    <i class="fas fa-globe"></i>
</button>
<button class="ctrl-btn" onclick="app.openCloudDrive()" title="‰∫ëÁ´ØËØæ‰ª∂Â∫ì" style="background:#fbbf24; color:black; margin-left:5px;">
    <i class="fas fa-cloud"></i>
</button>
                </div>
            </div>
            <div class="roster-split-layout">
                <div class="all-students-area" id="poolArea" ondrop="app.drop(event, 'Êú™ÂàÜÁªÑ')" ondragover="event.preventDefault()">
                    <div style="padding:10px; font-size:0.9rem; color:#666; text-align:center;">Êú™ÂàÜÁªÑÂ≠¶Âëò</div>
                    <div class="pool-content" id="poolContent" style="position:relative; min-height:200px;">
                        <div id="pool-empty-state" style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); text-align:center; color:#94a3b8; pointer-events:none;">
                            <i class="fas fa-seedling" style="font-size:3rem; margin-bottom:10px; opacity:0.5;"></i>
                            <div>ÊöÇÊó†Â≠¶Áîü<br>ËØ∑ÁÇπÂáªÂ∫ïÈÉ®ÂØºÂÖ•ÂêçÂçï</div>
                        </div>
                    </div>
                </div>
                <div class="groups-stage-area" id="groupStage"></div>
            </div>

            <!-- Âçï‰∫∫Ê®°ÂºèÁªìÊûúÂ±Ç (V1) -->
            <div id="single-mode-result-layer">
                <button class="q-close-btn" onclick="app.closeOverlay()" title="ÂÖ≥Èó≠ (‰∏çËÆ°ÂàÜ)"><i class="fas fa-times"></i></button>
                <div id="single-card-container"></div>
                <div id="single-btn-container" style="margin-top:30px; display:flex; gap:20px;">
                    <button class="pk-judge-btn btn-win" onclick="app.judgeSingle(true)">üéâ Ëé∑ËÉú</button>
                    <button class="pk-judge-btn btn-loss" onclick="app.judgeSingle(false)">üí™ ÈÅóÊÜæ</button>
                </div>
            </div>
        </div>

        <!-- Â∫ïÈÉ®ÊéßÂà∂Ê†è (Êõ¥Êñ∞Áâà) -->
        <div class="controls" id="main-controls">
            <button class="ctrl-btn toggle-btn" onclick="app.toggleBar('main-controls', this)" title="Êî∂Ëµ∑Â∑•ÂÖ∑Ê†è"><i class="fas fa-chevron-down"></i></button>
            
            <button class="ctrl-btn" onclick="app.toggleLecture()" title="Â±ïÂºÄ/Êî∂Ëµ∑ÊïôÂ≠¶ÁôΩÊùø">
                <i class="fas fa-chalkboard-teacher"></i>
            </button>            <button class="ctrl-btn" onclick="el('usbLoader').click()" title="üìÇ ËØªÂèñÊú¨Âú∞ËØæ‰ª∂(USB)" style="background:var(--gold); color:black;">
                <i class="fas fa-folder-open"></i>
            </button>
            <!-- Êñ∞Â¢ûÔºöÁΩëÁ´ôÊî∂ËóèÊåâÈíÆ -->
            <button class="ctrl-btn" onclick="app.openWebsites()" title="Â∏∏Áî®ÁΩëÁ´ôÊî∂Ëóè" style="background:#0ea5e9; color:white; margin-left:5px;">
                <i class="fas fa-globe"></i>
            </button>
            <button class="ctrl-btn" onclick="app.openCloudDrive()" title="‰∫ëÁ´ØËØæ‰ª∂Â∫ì" style="background:#fbbf24; color:black; margin-left:5px;">
                <i class="fas fa-cloud"></i>
            </button>
            
            <div style="width:1px; background:#555; height:20px; align-self:center;"></div>

            <button class="ctrl-btn primary" id="btn-roll" onclick="app.startRoll('single')" title="ÈöèÊú∫ÁÇπÂêç"><i class="fas fa-dice-d20"></i></button>
            <button class="ctrl-btn pk" id="btn-pk" onclick="app.startRoll('pk')" title="PKÂØπÂÜ≥"><i class="fas fa-khanda"></i></button>
            
            <button class="ctrl-btn" onclick="app.resetStatus()" title="ÈáçÁΩÆÁä∂ÊÄÅ"><i class="fas fa-undo"></i></button>
            
            <button class="ctrl-btn" onclick="el('quizFile').click()" title="ÂØºÂÖ•È¢òÂ∫ì" style="color:#4ade80;"><i class="fas fa-file-import"></i></button>

            <div style="width:1px; background:#555; height:20px; align-self:center;"></div>
            
            <button class="ctrl-btn" onclick="app.openImport()" title="ÂØºÂÖ•ÂêçÂçï"><i class="fas fa-user-plus"></i></button>
            <button class="ctrl-btn" onclick="app.switchClass()" title="ÂàáÊç¢Áè≠Á∫ß" style="background:#f59e0b; color:white;">
                <i class="fas fa-exchange-alt"></i>
            </button>
            <button class="ctrl-btn" onclick="app.logout()" title="ÈÄÄÂá∫ÁôªÂΩï" style="background:#ef4444;"><i class="fas fa-sign-out-alt"></i></button>
        </div>
    </div>

<!-- Êñ∞Â¢ûÔºöÁΩëÁ´ôÊî∂Ëóè Modal -->
<div id="website-modal" class="modal">
    <div class="modal-box" style="width: 600px; background: #1a1a1a; border: 1px solid #444;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; border-bottom:1px solid #333; padding-bottom:15px;">
            <h3 style="margin:0; font-size:1.5rem; color:#0ea5e9;"><i class="fas fa-globe"></i> Â∏∏Áî®ÁΩëÁ´ô‰∫ëÊî∂Ëóè</h3>
            <button class="close-modal" onclick="el('website-modal').style.display='none'" style="position:static;"><i class="fas fa-times"></i></button>
        </div>
        
        <div class="web-input-group">
            <input id="web-input-title" class="web-input" placeholder="ÁΩëÁ´ôÂêçÁß∞ (‰æãÂ¶Ç: BÁ´ô„ÄÅÁôæÂ∫¶)">
            <input id="web-input-url" class="web-input" placeholder="ÁΩëÂùÄ (‰æãÂ¶Ç: bilibili.com)">
            <button class="web-add-btn" onclick="app.addWebsite()"><i class="fas fa-plus"></i> Ê∑ªÂä†</button>
        </div>

        <div id="web-list" class="web-list-container">
            <!-- ÂàóË°®Â∞ÜÁî± JS Âä®ÊÄÅÁîüÊàê -->
            <div style="text-align:center; color:#666; padding:20px;">Ê≠£Âú®‰ªé‰∫ëÁ´ØÂä†ËΩΩ...</div>
        </div>
    </div>
</div>

<div id="courseware-modal" class="modal">
    <div class="modal-box" style="width: 980px; background: #0f0f0f; border: 1px solid #333;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; border-bottom:1px solid #222; padding-bottom:12px;">
            <h3 style="margin:0; font-size:1.4rem; color:var(--gold);"><i class="fas fa-cloud"></i> ‰∫ëÁ´ØËØæ‰ª∂Â∫ì</h3>
            <button class="close-modal" onclick="el('courseware-modal').style.display='none'" style="position:static;"><i class="fas fa-times"></i></button>
        </div>

        <div class="courseware-toolbar">
            <button class="upload-btn-ui" onclick="app.triggerCoursewareUploader()" style="width:auto; justify-content:center;">
                <i class="fas fa-upload"></i> ‰∏ä‰º† PDF / MP4
            </button>
            <div id="courseware-status" style="color:#94a3b8; font-size:0.9rem;"></div>
            <button class="upload-btn-ui" onclick="app.loadCoursewareList()" style="width:auto; justify-content:center; margin-left:auto;">
                <i class="fas fa-sync"></i> Âà∑Êñ∞
            </button>
        </div>

        <div class="courseware-layout">
            <div class="courseware-left">
                <div id="courseware-list" class="courseware-list">
                    <div style="text-align:center; color:#666; padding:20px;">Ê≠£Âú®‰ªé‰∫ëÁ´ØÂä†ËΩΩ...</div>
                </div>
            </div>
            <div class="courseware-right">
                <div id="courseware-preview" class="courseware-preview">
                    <div style="text-align:center; color:#666; padding:40px;">
                        <i class="fas fa-photo-video" style="font-size:3rem; opacity:0.25;"></i>
                        <div style="margin-top:10px;">ËØ∑ÈÄâÊã©‰∏Ä‰∏™ËØæ‰ª∂ËøõË°åÊí≠Êîæ</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
    <div id="import-modal" class="modal">
        <div class="modal-box" style="width:600px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h3>üìÇ ÂØºÂÖ• <span id="import-class-name" style="color:var(--primary)"></span> Â≠¶ÁîüÂêçÂçï</h3>
                <button class="close-modal" onclick="el('import-modal').style.display='none'"><i class="fas fa-times"></i></button>
            </div>
            
            <div style="background:#222; padding:15px; border-radius:8px; margin-bottom:15px; border:1px dashed #555;">
                <div style="font-size:0.9rem; color:#aaa; margin-bottom:10px;">ÊñπÊ≥ï‰∏ÄÔºöÁõ¥Êé•ËØªÂèñ TXT Êñá‰ª∂ (Êé®Ëçê)</div>
                <button class="upload-btn-ui" onclick="el('txt-roster-loader').click()" style="width:100%; justify-content:center;">
                    <i class="fas fa-file-alt"></i> ÈÄâÊã©Êú¨Âú∞ TXT ÂêçÂçïÊñá‰ª∂
                </button>
                <input type="file" id="txt-roster-loader" accept=".txt" style="display:none" onchange="app.handleTxtImport(this)">
                <div style="font-size:0.8rem; color:#666; margin-top:5px;">* TXTÊ†ºÂºèË¶ÅÊ±ÇÔºöÊØèË°å‰∏Ä‰∏™Â≠¶ÁîüÔºå‰æãÂ¶Ç‚ÄúÂº†‰∏â Áî∑‚ÄùÊàñ‰ªÖ‚ÄúÂº†‰∏â‚Äù</div>
            </div>

            <div style="border-top:1px solid #333; padding-top:15px;">
                <div style="font-size:0.9rem; color:#aaa; margin-bottom:10px;">ÊñπÊ≥ï‰∫åÔºöÊâãÂä®Á≤òË¥¥ÊñáÊú¨</div>
                <textarea id="import-text" style="width:100%; height:150px; background:#111; color:white; border:1px solid #333; padding:10px;" placeholder="Âº†‰∏â Áî∑&#10;ÊùéÂõõ Â•≥"></textarea>
                <div style="margin-top:10px; text-align:right;">
                    <button class="login-btn" style="width:auto; padding:8px 25px;" onclick="app.parseImport()">‰øùÂ≠òÂπ∂‰∏ä‰º†‰∫ëÁ´Ø</button>
                </div>
            </div>
        </div>
    </div>

    <!-- PK Ë¶ÜÁõñÂ±Ç -->
    <div id="winner-overlay" style="display:none;">
        <button class="q-close-btn" onclick="app.closeOverlay()" title="ÂÖ≥Èó≠ (‰∏çËÆ°ÂàÜ)">
            <i class="fas fa-times"></i>
        </button>
        <div class="pk-layout-wrapper">
            <div class="pk-left-panel" id="pk-left-panel">
                <div style="display:flex; flex-direction:column; align-items:center;">
                    <div id="pk-card-1" class="pk-card-large">
                        <div class="effect-layer"></div>
                        <div class="content-layer">
                            <div class="avatar-wrapper">
                                <img id="pk-img-1" class="avatar-img" src="">
                                <div id="pk-pendant-1" class="rank-pendant fa"></div>
                            </div>
                            <div id="pk-name-1" class="pk-name">ÈÄâÊâãA</div>
                            <div id="pk-sign-1" class="pk-sign">Sign</div>
                            <div class="win-loss-bar">
                                <span class="win-tag">ÁßØÂàÜ <span id="pk-win-1">0</span></span>
                            </div>
                            <div id="pk-rank-name-1" class="pk-rank-text"></div>
                        </div>
                    </div>
                </div>
                <div class="vs-column">
                    <div class="vs-text">V</div>
                    <div class="vs-text">S</div>
                </div>
                <div style="display:flex; flex-direction:column; align-items:center;">
                    <div id="pk-card-2" class="pk-card-large">
                        <div class="effect-layer"></div>
                        <div class="content-layer">
                            <div class="avatar-wrapper">
                                <img id="pk-img-2" class="avatar-img" src="">
                                <div id="pk-pendant-2" class="rank-pendant fa"></div>
                            </div>
                            <div id="pk-name-2" class="pk-name">ÈÄâÊâãB</div>
                            <div id="pk-sign-2" class="pk-sign">Sign</div>
                            <div class="win-loss-bar">
                                <span class="win-tag">ÁßØÂàÜ <span id="pk-win-2">0</span></span>
                            </div>
                            <div id="pk-rank-name-2" class="pk-rank-text"></div>
                        </div>
                    </div>
                </div>
                <div style="position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%); display: flex; gap: 100px; z-index: 100;">
                    <button class="pk-judge-btn btn-win" onclick="app.judgePK('left')">
                        <i class="fas fa-trophy"></i> Â∑¶‰æßËé∑ËÉú
                    </button>
                    <button class="pk-judge-btn btn-win" onclick="app.judgePK('right')">
                        Âè≥‰æßËé∑ËÉú <i class="fas fa-trophy"></i>
                    </button>
                </div>
            </div>
            <div class="pk-right-panel" id="pk-right-panel">
                <div class="question-stage" id="q-stage-box">
                    <select id="timer-select" onchange="app.resetTimer()">
                        <option value="10">10s</option>
                        <option value="30" selected>30s</option>
                        <option value="60">60s</option>
                        <option value="90">90s</option>
                        <option value="300">300s</option>
                    </select>
                    <div class="q-timer" id="timer-display">30</div>
                    <div class="q-zoom-controls">
                        <button class="zoom-btn" onclick="app.zoomQ(0.2)" title="ÊîæÂ§ß">+</button>
                        <button class="zoom-btn" onclick="app.resetZoomQ()" title="Â§ç‰Ωç">‚Ü∫</button>
                        <button class="zoom-btn" onclick="app.zoomQ(-0.2)" title="Áº©Â∞è">-</button>
                    </div>
                    <div id="question-wrapper">
                        <div id="question-content"></div>
                    </div>
                    <div id="answer-content"></div>
                    <button onclick="document.getElementById('answer-content').style.display='block'" class="show-answer-btn">Á≠îÊ°à</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ‰∏™‰∫∫‰∏≠ÂøÉ (V1 È£éÊ†º + V2 ÈÄªËæë) -->
    <div id="profile-modal" class="modal">
        <div class="modal-box" id="profile-box">
            <button class="close-modal" onclick="app.closeProfile()"><i class="fas fa-times"></i></button>

            <div id="vip-profile" class="vip-profile">
                <div class="vip-header">
                    <div class="vip-header-text">
                        Â≠¶Áîü‰∏™‰∫∫‰ø°ÊÅØÂç°Áâá
                    </div>
                    <button class="vip-glass-btn" type="button">ÁºñËæëËµÑÊñô</button>
                </div>

                <div class="vip-body">
                    <div class="vip-main">
                        <div class="vip-glass-card vip-student-info-card">
                            <div class="vip-card-head">
                                <div class="vip-card-title">Â≠¶Áîü‰∏™‰∫∫‰ø°ÊÅØÂç°Áâá</div>
                                <div id="vip-rank-top" class="vip-rank-top">Áß∞Âè∑</div>
                            </div>

                            <div class="vip-student-layout">
                                <div class="vip-mini-card-slot">
                                    <div id="vip-mini-card" class="card"></div>
                                </div>
                                <div class="vip-id-block">
                                    <div id="vip-name" class="vip-id-name">ÂßìÂêç</div>
                                    <div class="vip-id-row">
                                        <div id="vip-class" class="vip-id-class">Áè≠Á∫ß</div>
                                        <div class="vip-dot">¬∑</div>
                                        <div class="vip-id-points"><span id="vip-points" class="vip-points">0</span><span class="vip-sub"> ÁßØÂàÜ</span></div>
                                    </div>
                                    <div id="vip-sign-top" class="vip-sign-top">‚Äî</div>
                                </div>
                            </div>
                        </div>

                        <div class="vip-legacy-panel">
                            <div class="vip-legacy-stats">
                                <div class="vip-legacy-stat">
                                    <div class="vip-legacy-k">ÁßØÂàÜ</div>
                                    <div class="vip-legacy-pill">
                                        <div id="vip-legacy-wins" class="vip-legacy-v">0</div>
                                    </div>
                                </div>
                                <div class="vip-legacy-sign">
                                    <div class="vip-legacy-k">‰∏™ÊÄßÁ≠æÂêçÔºàÂÆûÊó∂È¢ÑËßàÔºâ</div>
                                    <input id="vip-sign-input" class="vip-legacy-input" maxlength="15" oninput="app.updateSignPreview(this.value)">
                                </div>
                            </div>

                            <div class="vip-legacy-assets">
                                <div class="vip-legacy-asset">
                                    <div class="vip-legacy-asset-head">
                                        <div class="vip-legacy-k">Êõ¥Êç¢Â§¥ÂÉè</div>
                                        <div class="vip-legacy-actions">
                                            <span class="vip-legacy-link" onclick="app.refreshVipAvatars()">Êç¢‰∏ÄÊâπ(‰∫ëÁ´Ø)</span>
                                            <span class="vip-legacy-sep">|</span>
                                            <span class="vip-legacy-link" onclick="el('uploadAvatar').click()">‰∏ä‰º†(Êú¨Âú∞)</span>
                                        </div>
                                    </div>
                                    <div class="vip-legacy-grid" id="vip-avatar-grid"></div>
                                </div>
                                <div class="vip-legacy-asset">
                                    <div class="vip-legacy-asset-head">
                                        <div class="vip-legacy-k">‰∏ªÈ°µËÉåÊôØÔºàÈ≤úËâ≥/Ê∏êÂèòÔºâ</div>
                                    </div>
                                    <div class="vip-legacy-bggrid" id="vip-bg-grid"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="vip-side">
                        <div class="vip-glass-card vip-pet-module">
                            <div class="vip-pet-module-left">
                                <div class="vip-pet-module-title">ËêåÂÆ†Â±ïÁ§∫ üòä</div>
                                <div class="vip-petmeta-grid">
                                    <div class="vip-petmeta-line"><span class="vip-petmeta-k">ÂÆ†Áâ©Á±ªÂûãÔºö</span><select id="vip-pet-select" class="vip-pet-select"></select></div>
                                    <div class="vip-petmeta-line"><span class="vip-petmeta-k">Êó∂ÊúüÔºö</span><span id="vip-pet-period" class="vip-petmeta-v">‚Äî</span></div>
                                    <div class="vip-petmeta-line"><span class="vip-petmeta-k">ÂêçÁß∞Ôºö</span><span id="vip-pet-name" class="vip-petmeta-v">‚Äî</span></div>
                                </div>
                            </div>
                            <div class="vip-pet-module-right">
                                <div class="vip-pet-gif-box">
                                    <img id="vip-pet-gif" class="vip-pet-gif" src="/pets/ÊÅêÈæôËõã1.gif" alt="pet">
                                </div>
                                <div class="vip-pet-exp">
                                    <div class="vip-exp-meta">
                                        <div class="vip-card-title" style="margin:0;">ÁªèÈ™åÂÄº</div>
                                        <div id="vip-exp-text" class="vip-exp-text">0 / 5</div>
                                    </div>
                                    <div class="vip-exp-bar">
                                        <div id="vip-exp-fill" class="vip-exp-fill" style="width:0%;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="profile-top-section">
                <div class="profile-card-container">
                    <div id="profile-preview-card" class="card"></div>
                </div>
                <div class="profile-pet-panel">
                    <div class="profile-pet-left">
                        <div class="profile-pet-title">ËêåÂÆ†Â±ïÁ§∫ üòä</div>
                        <div class="profile-pet-grid">
                            <div class="profile-pet-field">
                                <div class="profile-pet-k">ÂÆ†Áâ©Á±ªÂûãÔºö</div>
                                <div id="p-pet-type" class="profile-pet-v"><select id="p-pet-select" class="profile-pet-select"></select></div>
                            </div>
                            <div class="profile-pet-field">
                                <div class="profile-pet-k">Êó∂ÊúüÔºö</div>
                                <div id="p-pet-period" class="profile-pet-v">‚Äî</div>
                            </div>
                            <div class="profile-pet-field">
                                <div class="profile-pet-k-row">
                                    <div class="profile-pet-k">ÂêçÁß∞Ôºö</div>
                                    <button class="profile-pet-edit" type="button" onclick="app.beginEditProfilePetName()" aria-label="ÁºñËæëËêåÂÆ†ÂêçÁß∞">
                                        <i class="fas fa-pen"></i>
                                    </button>
                                </div>
                                <div id="p-pet-name" class="profile-pet-v">‚Äî</div>
                                <input id="p-pet-name-input" class="profile-pet-name-input" maxlength="5" style="display:none;" />
                            </div>
                        </div>
                    </div>
                    <div class="profile-pet-right">
                        <div class="profile-pet-gifbox">
                            <img id="p-pet-gif" class="profile-pet-gif" src="/pets/ÊÅêÈæôËõã1.gif" alt="pet">
                        </div>
                        <div class="profile-pet-exp">
                            <div class="profile-pet-exp-row">
                                <div class="profile-pet-exp-label">ÁªèÈ™åÂÄº</div>
                                <div id="p-exp-text" class="profile-pet-exp-text">0 / 5</div>
                            </div>
                            <div class="profile-pet-exp-bar">
                                <div id="p-exp-fill" class="profile-pet-exp-fill" style="width:0%;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="profile-controls futuristic-controls">
                <div class="profile-feature-wrap">
                    <div class="profile-feature-card traits-card">
                        <div class="profile-feature-head">
                            <div id="traits-title" class="profile-feature-title">Â≠¶Ê†°Ë°®Áé∞Èõ∑ËææÂõæ</div>
                            <button id="traits-generate" class="traits-generate" type="button" onclick="app.generateTraitsAnalysis()">ÁîüÊàêËß£Êûê</button>
                        </div>
                        <div id="traits-radar" class="traits-radar"></div>
                        <div id="traits-ai" class="traits-ai"></div>
                    </div>
                    <div class="profile-feature-card">
                        <div id="behavior-title" class="profile-feature-title">ÁßØÂàÜËØÑ‰ª∑</div>
                        <div class="behavior-grid">
                            <!-- 1. ËÆ§Áúü (Serious) -->
                            <div class="behavior-item behavior-indigo">
                                <div class="behavior-pill">
                                    <svg class="behavior-ico" viewBox="0 0 24 24" fill="none">
                                        <path d="M4 19a2 2 0 0 1 2-2h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                        <path d="M6 3h14v16H6a2 2 0 0 0-2 2V5a2 2 0 0 1 2-2z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                                        <path d="M8 7h8M8 10h8M8 13h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    </svg>
                                    <span>ËÆ§Áúü</span>
                                </div>
                                <div class="behavior-ctrl">
                                    <button class="behavior-btn behavior-btn-minus" type="button" onclick="app.adjBehavior('serious', -1)" aria-label="ËÆ§Áúü -1">-</button>
                                    <button class="behavior-edit" type="button" onclick="app.promptBehavior('serious')" aria-label="ÁºñËæëËÆ§Áúü">
                                        <span id="behavior-serious" class="behavior-edit-val">0</span>
                                    </button>
                                    <button class="behavior-btn behavior-btn-plus" type="button" onclick="app.adjBehavior('serious', 1)" aria-label="ËÆ§Áúü +1">+</button>
                                </div>
                            </div>
                            
                            <!-- 2. Âã§Â•ã (Diligent) -->
                            <div class="behavior-item behavior-amber">
                                <div class="behavior-pill">
                                    <svg class="behavior-ico" viewBox="0 0 24 24" fill="none">
                                        <path d="M13 2L3 14h7l-1 8 12-14h-7l-1-6z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                                    </svg>
                                    <span>Âã§Â•ã</span>
                                </div>
                                <div class="behavior-ctrl">
                                    <button class="behavior-btn behavior-btn-minus" type="button" onclick="app.adjBehavior('diligent', -1)" aria-label="Âã§Â•ã -1">-</button>
                                    <button class="behavior-edit" type="button" onclick="app.promptBehavior('diligent')" aria-label="ÁºñËæëÂã§Â•ã">
                                        <span id="behavior-diligent" class="behavior-edit-val">0</span>
                                    </button>
                                    <button class="behavior-btn behavior-btn-plus" type="button" onclick="app.adjBehavior('diligent', 1)" aria-label="Âã§Â•ã +1">+</button>
                                </div>
                            </div>

                            <!-- 3. ËÅ™Êòé (Smart) -->
                            <div class="behavior-item behavior-yellow">
                                <div class="behavior-pill">
                                    <svg class="behavior-ico" viewBox="0 0 24 24" fill="none">
                                        <path d="M9 18h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                        <path d="M10 22h4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                        <path d="M8 14c-1.2-1-2-2.5-2-4.5A6 6 0 0 1 12 3a6 6 0 0 1 6 6.5c0 2-0.8 3.5-2 4.5-0.8 0.7-1 1.3-1 2H9c0-0.7-0.2-1.3-1-2z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                                    </svg>
                                    <span>ËÅ™Êòé</span>
                                </div>
                                <div class="behavior-ctrl">
                                    <button class="behavior-btn behavior-btn-minus" type="button" onclick="app.adjBehavior('smart', -1)" aria-label="ËÅ™Êòé -1">-</button>
                                    <button class="behavior-edit" type="button" onclick="app.promptBehavior('smart')" aria-label="ÁºñËæëËÅ™Êòé">
                                        <span id="behavior-smart" class="behavior-edit-val">0</span>
                                    </button>
                                    <button class="behavior-btn behavior-btn-plus" type="button" onclick="app.adjBehavior('smart', 1)" aria-label="ËÅ™Êòé +1">+</button>
                                </div>
                            </div>

                            <!-- 4. ‰πê‰∫éÂä©‰∫∫ (Helpful) -->
                            <div class="behavior-item behavior-rose">
                                <div class="behavior-pill">
                                    <svg class="behavior-ico" viewBox="0 0 24 24" fill="none">
                                        <path d="M12 21s-8-4.5-8-10a4.5 4.5 0 0 1 8-2 4.5 4.5 0 0 1 8 2c0 5.5-8 10-8 10z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                                    </svg>
                                    <span>ÂñÑËâØ</span>
                                </div>
                                <div class="behavior-ctrl">
                                    <button class="behavior-btn behavior-btn-minus" type="button" onclick="app.adjBehavior('helpful', -1)" aria-label="ÂñÑËâØ -1">-</button>
                                    <button class="behavior-edit" type="button" onclick="app.promptBehavior('helpful')" aria-label="ÁºñËæëÂñÑËâØ">
                                        <span id="behavior-helpful" class="behavior-edit-val">0</span>
                                    </button>
                                    <button class="behavior-btn behavior-btn-plus" type="button" onclick="app.adjBehavior('helpful', 1)" aria-label="ÂñÑËâØ +1">+</button>
                                </div>
                            </div>

                            <!-- 5. Âõ¢Áªì (United) -->
                            <div class="behavior-item behavior-cyan">
                                <div class="behavior-pill">
                                    <svg class="behavior-ico" viewBox="0 0 24 24" fill="none">
                                        <path d="M17 21v-2a4 4 0 0 0-4-4H7a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                        <path d="M7 11a4 4 0 1 0 0-8 4 4 0 0 0 0 8z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                                        <path d="M21 21v-2a3.5 3.5 0 0 0-3-3.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                        <path d="M17 3.5a3.5 3.5 0 0 1 0 7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    </svg>
                                    <span>Âõ¢Áªì</span>
                                </div>
                                <div class="behavior-ctrl">
                                    <button class="behavior-btn behavior-btn-minus" type="button" onclick="app.adjBehavior('united', -1)" aria-label="Âõ¢Áªì -1">-</button>
                                    <button class="behavior-edit" type="button" onclick="app.promptBehavior('united')" aria-label="ÁºñËæëÂõ¢Áªì">
                                        <span id="behavior-united" class="behavior-edit-val">0</span>
                                    </button>
                                    <button class="behavior-btn behavior-btn-plus" type="button" onclick="app.adjBehavior('united', 1)" aria-label="Âõ¢Áªì +1">+</button>
                                </div>
                            </div>

                            <!-- 6. Á§ºË≤å (Polite) -->
                            <div class="behavior-item behavior-emerald">
                                <div class="behavior-pill">
                                    <svg class="behavior-ico" viewBox="0 0 24 24" fill="none">
                                        <path d="M18 8a6 6 0 0 1-12 0" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                        <path d="M8 14s1 2 4 2 4-2 4-2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                        <path d="M9 10h.01M15 10h.01" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
                                        <path d="M12 22c4.5 0 9-3.5 9-10S16.5 2 12 2 3 5.5 3 12s4.5 10 9 10z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                                    </svg>
                                    <span>Á§ºË≤å</span>
                                </div>
                                <div class="behavior-ctrl">
                                    <button class="behavior-btn behavior-btn-minus" type="button" onclick="app.adjBehavior('polite', -1)" aria-label="Á§ºË≤å -1">-</button>
                                    <button class="behavior-edit" type="button" onclick="app.promptBehavior('polite')" aria-label="ÁºñËæëÁ§ºË≤å">
                                        <span id="behavior-polite" class="behavior-edit-val">0</span>
                                    </button>
                                    <button class="behavior-btn behavior-btn-plus" type="button" onclick="app.adjBehavior('polite', 1)" aria-label="Á§ºË≤å +1">+</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <button class="save-btn-full" onclick="app.saveProfile()">‰øùÂ≠ò‰øÆÊîπÂπ∂ÂêåÊ≠•Âà∞‰∫ëÁ´Ø</button>
            </div>

            <div id="avatar-dialog" class="avatar-dialog" style="display:none;">
                <div class="avatar-dialog-mask" onclick="app.closeAvatarDialog()"></div>
                <div class="avatar-dialog-card" role="dialog" aria-modal="true" aria-label="Êõ¥Êç¢Â§¥ÂÉè">
                    <div class="avatar-dialog-head">
                        <div class="avatar-dialog-title">Êõ¥Êç¢Â§¥ÂÉè</div>
                        <button class="avatar-dialog-close" type="button" onclick="app.closeAvatarDialog()" aria-label="ÂÖ≥Èó≠">√ó</button>
                    </div>
                    <div class="avatar-dialog-actions">
                        <span class="avatar-dialog-link" onclick="app.refreshAvatars()">Êç¢‰∏ÄÊâπ(‰∫ëÁ´Ø)</span>
                        <span class="avatar-dialog-sep">|</span>
                        <span id="avatar-upload-link" class="avatar-dialog-link" onclick="el('uploadAvatar').click()">‰∏ä‰º†(Êú¨Âú∞)</span>
                    </div>
                    <div id="avatar-grid" class="avatar-dialog-grid"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="student-profile-modal" class="modal">
        <div class="modal-box" style="width:min(1200px, 96vw); height:min(92vh, 920px); padding:0; overflow:hidden;">
            <button class="close-modal" onclick="app.closeStudentProfile()" style="z-index:10;"><i class="fas fa-times"></i></button>
            <iframe id="student-profile-iframe" src="about:blank" style="width:100%; height:100%; border:0;"></iframe>
        </div>
    </div>

    <!-- ÊàêÁª©ËµõË∑ë Modal (ËøòÂéü V1) -->
    <div id="race-modal" class="modal">
        <div class="modal-box">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h2 style="margin:0; color:var(--primary); font-family:'Zcool KuaiLe'; font-size: 2rem;"><i class="fas fa-flag-checkered"></i> ÊàêÁª©ËµõË∑ë</h2>
                <button onclick="el('race-modal').style.display='none'" style="background:none; border:none; color:#aaa; cursor:pointer; font-size:1.5rem;"><i class="fas fa-times"></i></button>
            </div>
            <div style="display:flex; gap:30px; margin-top:20px; flex:1; overflow:hidden;">
                <div style="width:250px; display:flex; flex-direction:column; gap:20px; border-right:1px solid #333; padding-right:20px;">
                    <div>
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
                            <label style="color:#aaa; font-size:1rem; font-weight:bold;">Á≤òË¥¥ÊàêÁª© (ÂßìÂêç ÂàÜÊï∞)</label>
                            <button class="sub-btn" onclick="el('raceTxtInput').click" style="padding:3px 8px; font-size:0.8rem; background:#444; color:white; border:none; border-radius:4px; cursor:pointer;"><i class="fas fa-file-alt"></i> ÂØºÂÖ•TXT</button>
                            <input type="file" id="raceTxtInput" accept=".txt" style="display:none" onchange="app.handleRaceImport(this)">
                        </div>
                        <div style="color:#666; font-size:0.8rem; margin-bottom:5px;">ÂêåÂàÜ‰∏çËÉΩÂú®ÂêåÈÅìÔºåÊØèÈÅìÈôê3‰∫∫</div>
                        <textarea id="race-input" oninput="app.saveRaceData()" style="width:100%; height:400px; background:#111; border:1px solid #333; color:white; padding:15px; border-radius:12px; box-sizing:border-box; font-size:1rem; line-height:1.5;" placeholder="Âº†‰∏â 98&#10;ÊùéÂõõ 95&#10;Áéã‰∫î 100"></textarea>
                    </div>
                    <div>
                        <button onclick="app.initRace()" class="save-btn-full" style="background:#555;">Âä†ËΩΩ/ÂàÜÈÖçË∑ëÈÅì</button>
                        <button onclick="app.runRace()" class="save-btn-full" style="margin-top:10px; background: #3b82f6;">ÂºÄÂßãËµõË∑ë</button>
                    </div>
                </div>
                <div style="flex:1; display:flex; flex-direction:column; overflow:hidden;">
                     <div style="text-align:right; color:#777; font-size:0.8rem; margin-bottom:5px;">
                         1ÂàÜ = 15px | 10Êù°Ë∑ëÈÅì | Ëá™Âä®Èò≤ÈáçÂè†
                     </div>
                     <div id="race-view" class="race-scroll-view">
                         <div id="race-board" class="race-track-board"></div>
                     </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Êô∫ËÉΩÂàÜÊûê Modal (ËøòÂéü V1) -->
    <div id="analysis-modal" class="modal">
        <div class="modal-box">
            <div class="analysis-header">
                <h2><i class="fas fa-chart-line"></i> Â≠¶ÁîüÊàêÁª©ÂàÜÊûêÊä•Âëä</h2>
                <div>
                    <button class="upload-btn-ui" onclick="app.checkAnalysisData()" style="margin-right:10px; background:#eab308; color:#000;">üõ†Ô∏è Êï∞ÊçÆËá™Ê£Ä</button>
                    <button class="upload-btn-ui" onclick="app.toggleAnalysisMode('single')" style="margin-right:10px; background:#444;">ÂçïÊ¨°ÂàÜÊûê</button>
                    <button class="upload-btn-ui btn-trend" onclick="app.toggleAnalysisMode('trend')">üìà Ë∂ãÂäøÂØπÊØî</button>
                    <button onclick="el('analysis-modal').style.display='none'" style="background:none; border:none; color:white; font-size:1.5rem; cursor:pointer; margin-left:20px;"><i class="fas fa-times"></i></button>
                </div>
            </div>
            
            <div class="analysis-content">
                <div id="single-report-section">
                    <div class="upload-section" style="grid-column: 1 / -1;">
                        <button class="upload-btn-ui" onclick="el('analysisFile').click()"><i class="fas fa-file-excel"></i> ÈÄâÊã© Excel Êñá‰ª∂ (.xlsx)</button>
                        <input type="file" id="analysisFile" accept=".xlsx" style="display:none" onchange="app.handleAnalysisUpload(this)">
                        <span style="color:#aaa; font-size:0.9rem;">ËØ∑‰∏ä‰º†ÂåÖÂê´‚ÄúÂßìÂêç‚ÄùÂèäÂêÑÁßëÊàêÁª©ÁöÑË°®Ê†º</span>
                    </div>

                    <!-- Â∑¶‰æßÔºöÂõæË°®Âå∫ -->
                    <div class="charts-column">
                        <div class="chart-container" style="min-height: 300px;">
                            <div class="chart-title">ÂêÑÁßëÂπ≥ÂùáÂàÜÊ®™ÂêëÂØπÊØî</div>
                            <div id="avgBarChart" style="flex:1;"></div>
                        </div>
                        
                        <div class="advice-box">
                            <div style="font-weight:bold; margin-bottom:10px; color:#60a5fa;"><i class="fas fa-robot"></i> AI ÂàÜÊûêÂª∫ËÆÆ:</div>
                            <div id="adviceText">ÊöÇÊó†Êï∞ÊçÆÔºåËØ∑ÂÖà‰∏ä‰º† Excel Êñá‰ª∂„ÄÇ</div>
                        </div>

                        <div class="chart-container">
                            <div class="chart-title">ÂêÑÁßëÊàêÁª©ÂàÜÂ∏É (Bar)</div>
                            <div id="barChart" style="flex:1;"></div>
                        </div>
                        
                        <!-- È•ºÂõæ -->
                        <div class="chart-container with-sidebar">
                            <div class="chart-sidebar" id="pie-subject-switch"></div>
                            <div style="flex:1; display:flex; flex-direction:column; overflow:hidden;">
                                <div class="chart-title">ÂàÜÊï∞ÊÆµÂç†ÊØî (Pie)</div>
                                <div id="pieChart" style="flex:1;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Âè≥‰æßÔºöÂÖ®È´òÊéíË°åÊ¶ú -->
                    <div class="analysis-sidebar">
                        <div class="rank-list-box">
                            <div class="chart-title" style="color:#fbbf24;">
                                <span>üèÜ Áè≠Á∫ßÊéíË°åÊ¶ú</span>
                                <div id="rank-subject-switch" class="sub-switch-group"></div>
                            </div>
                            <div class="rank-scroll-area">
                                <div id="rankList"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="trend-section">
                    <div class="upload-section" style="border-color: #d946ef;">
                        <button class="upload-btn-ui btn-trend" onclick="el('trendFiles').click()"><i class="fas fa-layer-group"></i> ÈÄâÊã©Â§ö‰∏™ Excel Êñá‰ª∂</button>
                        <input type="file" id="trendFiles" accept=".xlsx" multiple style="display:none" onchange="app.handleTrendUpload(this)">
                        <span style="color:#aaa; font-size:0.9rem;">Êåâ‰Ωè Ctrl/Cmd ÂèØÂ§öÈÄâÊñá‰ª∂</span>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 20px; height: 100;">
                        <div class="chart-container" id="trend-c1" style="flex:1;">
                            <div class="chart-title">ÂêÑÁßëÂπ≥ÂùáÂàÜË∂ãÂäø (Subject Trend)</div>
                            <div id="trendChart" style="width:100%; height:100%;"></div>
                        </div>
                        <div class="chart-container" id="trend-c2" style="flex:1;">
                            <div class="chart-title">ÂêÑÂàÜÊï∞ÊÆµ‰∫∫Êï∞ÂèòÂåñ (Distribution Trend)</div>
                            <div id="trendDistChart" style="width:100%; height:100%;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ‰∫ëÁ´ØÂ§áËØæ Modal (Êñ∞Â¢û) -->
    <div id="course-admin-modal" class="modal">
        <div class="modal-box" style="width:800px; height:80vh; display:flex; flex-direction:column;">
            <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                <h3>üìÇ ‰∫ëÁ´ØÂ§áËØæ‰∏≠ÂøÉ</h3>
                <button class="close-modal" onclick="el('course-admin-modal').style.display='none'"><i class="fas fa-times"></i></button>
            </div>
            <div style="display:flex; flex:1; gap:20px; overflow:hidden;">
                <div style="width:250px; border-right:1px solid #333; display:flex; flex-direction:column;">
                    <button class="sub-btn" onclick="app.createNewLesson()" style="margin-bottom:10px;">+ Êñ∞Âª∫ËØæÁ®ã</button>
                    <div id="admin-lesson-list" style="flex:1; overflow-y:auto"></div>
                </div>
                <div style="flex:1; display:flex; flex-direction:column;">
                    <div id="admin-step-editor" style="display:none; flex-direction:column; height:100%">
                        <h4 id="editor-title" style="margin:0 0 10px 0; color:var(--primary);">Ê≠£Âú®ÁºñËæë: ...</h4>
                        <div id="admin-step-list" style="flex:1; overflow-y:auto; background:#111; padding:10px; border:1px solid #333; margin-bottom:10px;"></div>
                        
                        <div style="background:#222; padding:10px; border-radius:8px;">
                            <span style="font-size:0.9rem; color:#aaa;">Ê∑ªÂä†ÁéØËäÇ:</span>
                            <div style="display:flex; gap:5px; margin-top:5px;">
                                <button class="sub-btn" onclick="app.addStep('video_bilibili')">üì∫ BÁ´ôËßÜÈ¢ë</button>
                                <button class="sub-btn" onclick="app.addStep('image')">üñºÔ∏è ÂõæÁâá</button>
                                <button class="sub-btn" onclick="app.addStep('html_game')">üéÆ ÁΩëÈ°µÊ∏∏Êàè</button>
                                </div>
                        </div>
                    </div>
                    <div id="admin-empty-state" style="margin:auto; color:#666;">ËØ∑Âú®Â∑¶‰æßÈÄâÊã©ÊàñÊñ∞Âª∫ËØæÁ®ã</div>
                </div>
            </div>
        </div>
    </div>
<!-- ============================================ -->
    <!-- Áº∫Â§±ÁöÑ‰øÆÂ§ç‰ª£Á†ÅÔºöÂàõÂª∫Áè≠Á∫ßÊªöËΩÆ Modal (V3.8) -->
    <!-- ============================================ -->
    <div id="roller-modal" class="modal" style="display:none;">
        <div class="roller-modal-box">
            <div class="roller-header">
                <div style="font-family:'Russo One'; font-size:1.8rem; color:#333; margin-bottom:5px;">
                    CREATE NEW CLASS
                </div>
                <div style="font-size:0.9rem; color:#94a3b8; font-weight:bold;">
                    ÊªëÂä®ÊªöËΩÆÈÄâÊã©Âπ¥Á∫ß‰∏éÁè≠Á∫ß
                </div>
            </div>
            
            <div class="roller-stage">
                <div class="roller-highlight-bar"></div>
                
                <!-- Âπ¥Á∫ßÊªöËΩÆ -->
                <div id="roller-grade" class="roller-column">
                    <!-- JS ‰ºöÂú®ËøôÈáåÁîüÊàêÂπ¥Á∫ßÈÄâÈ°π -->
                </div>
                
                <div style="font-size:2rem; font-weight:900; color:#cbd5e1; z-index:10;">-</div>
                
                <!-- Áè≠Á∫ßÊªöËΩÆ -->
                <div id="roller-class" class="roller-column">
                    <!-- JS ‰ºöÂú®ËøôÈáåÁîüÊàêÁè≠Á∫ßÈÄâÈ°π -->
                </div>
            </div>
            
            <div class="roller-footer">
                <button class="btn-wild-cancel" onclick="el('roller-modal').style.display='none'">
                    ÂèñÊ∂à (CANCEL)
                </button>
                <button class="btn-wild-confirm" onclick="app.confirmRollerCreate()">
                    Á°ÆËÆ§ÂàõÂª∫ <span id="roller-preview-text" style="font-size:0.9rem; opacity:0.8;">(...)</span>
                </button>
            </div>
        </div>
    </div>
    <!-- ÈöêËóèÁöÑËæìÂÖ•Ê°Ü -->
    <input type="file" id="uploadAvatar" accept="image/*" style="display:none" onchange="app.handleUploadAvatar(this)">
    <input type="file" id="usbLoader" webkitdirectory directory multiple style="display:none" onchange="app.loadUsbLesson(this)">
    <input type="file" id="genericFileLoader" style="display:none" multiple accept=".docx,.doc,.pdf,.xlsx,.xls,.mp4,.webm,.jpg,.jpeg,.png,.gif,.html,.htm,.pptx" onchange="app.handleGenericUpload('practice', event.target.files)">
    <input type="file" id="quizFile" accept=".docx,.txt,.pdf" style="display:none" onchange="app.loadQuiz(this)">
    <input type="file" id="coursewareUploader" style="display:none" multiple accept=".pdf,.mp4,application/pdf,video/mp4" onchange="app.handleCoursewareUpload(this)">
    

</body>
</html>
